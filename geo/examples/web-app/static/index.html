<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="description"
            content="A geo web application where geo is used to compute clustering"
        />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Geo: Cluster Demo</title>
        <style>
            figure {
                text-align: center;
            }
            canvas {
                display: block;
                margin: 0 auto;
                border: 1px solid black;
            }
            figcaption {
                margin-top: 10px;
            }
        </style>
    </head>

    <body>
        <h1>Example: Cluster demo</h1>
        <noscript>
            <h2>
                This page contains webassembly and javascript content, please
                enable javascript in your browser.
            </h2>
        </noscript>
        <figure>
            <canvas id="cluster" width="200" height="200"></canvas>
            <figcaption>
                <strong
                    >A set of points divided into two clusters "blue" and
                    "green"</strong
                >
            </figcaption>
        </figure>

        <p>
            This app performs k-means clustering on a set of points using
            <a
                href="https://docs.rs/geo/latest/geo/algorithm/kmeans/trait.KMeans.html#method.kmeans"
                >geo::algorithms::kmeans::KMeans::kmeans()</a
            >.
        </p>
        <p>
            This is intended as a minimum golden reference for buiding web apps
            using the geo crate.
        </p>
        <h2>Build Pipeline</h2>
        <ol>
            <li>
                The application is created in the form specific type of of a
                rust library. The crate-type MUST be set in the [lib] section of
                the Cargo.toml file as follows
                <ul style="list-style-type: none">
                    <li><strong>[lib]</strong></li>
                    <li><strong>crate-type = ["cdylib", "rlib"]</strong></li>
                </ul>
            </li>
            <li>
                WasmPack, through the WasmPackPlugin wraps the library up into a
                node package.
            </li>
            <li>
                The HTML page loads the node package into a sandboxed web-worker
            </li>
            <li>
                A script on the page then make calls to the web-worker to
                perform the clustering calculation off the main JS thread.
            </li>
        </ol>
        <h2>Source of randomness</h2>
        <p>
            k-means was chosen for the reference design because it exposes a
            issue obtaining a source of randomness.
        </p>
        <p>
            The source of randomness is derived from calls to the browser's
            sandbox environment
        </p>
        <p>
            This reference design is state of the art, which unfortunately
            includes the use of a subtle workaround.
        </p>
        <p>
            Even though this application (the "geo-web-app" rust library ) does
            not directly use the "getrandom" crate, a shaddow definition MUST be
            included to add a feature the actual inclusion of getrandom which is
            located here.
        </p>
        <p>geo-web-app -> geo -> rand -> getrandom</p>
        <script type="module" src="./index.js"></script>
    </body>
</html>
